<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node-mutation.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AppendAction.html">AppendAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppendAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppendAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppendAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppendAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppendAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppendAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppendAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AppendAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="BaseAction.html">BaseAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BaseAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BaseAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BaseAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BaseAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BaseAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BaseAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BaseAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ConflictActionError.html">ConflictActionError</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DeleteAction.html">DeleteAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DeleteAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DeleteAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DeleteAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DeleteAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DeleteAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DeleteAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DeleteAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DeleteAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EspreeAdapter.html">EspreeAdapter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EspreeAdapter.html#childNodeRange">childNodeRange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EspreeAdapter.html#childNodeValue">childNodeValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EspreeAdapter.html#fileContent">fileContent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="GonzalesPeAdapter.html">GonzalesPeAdapter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GonzalesPeAdapter.html#childNodeRange">childNodeRange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GonzalesPeAdapter.html#childNodeValue">childNodeValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GonzalesPeAdapter.html#fileContent">fileContent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="GroupAction.html">GroupAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GroupAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="InsertAction.html">InsertAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InsertAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InsertAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InsertAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InsertAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InsertAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InsertAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InsertAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="InsertAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="NodeMutation.html">NodeMutation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#.configure">configure</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#append">append</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#group">group</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#insert">insert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#noop">noop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#prepend">prepend</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#replace">replace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#replaceWith">replaceWith</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#rewriteSource">rewriteSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NodeMutation.html#test">test</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="NoopAction.html">NoopAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoopAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoopAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoopAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoopAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoopAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoopAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoopAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoopAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="NotSupportedError.html">NotSupportedError</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PrependAction.html">PrependAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PrependAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PrependAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PrependAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PrependAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PrependAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PrependAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PrependAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PrependAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RemoveAction.html">RemoveAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemoveAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemoveAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemoveAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemoveAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemoveAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemoveAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemoveAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RemoveAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ReplaceAction.html">ReplaceAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ReplaceWithAction.html">ReplaceWithAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceWithAction.html#calculatePositions">calculatePositions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceWithAction.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceWithAction.html#removeComma">removeComma</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceWithAction.html#removeSpace">removeSpace</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceWithAction.html#rewrittenSource">rewrittenSource</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceWithAction.html#source">source</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceWithAction.html#squeezeLines">squeezeLines</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ReplaceWithAction.html#squeezeSpaces">squeezeSpaces</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TypescriptAdapter.html">TypescriptAdapter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TypescriptAdapter.html#childNodeRange">childNodeRange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TypescriptAdapter.html#childNodeValue">childNodeValue</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getAdapter">getAdapter</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">node-mutation.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var __importDefault = (this &amp;&amp; this.__importDefault) || function (mod) {
    return (mod &amp;&amp; mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const typescript_1 = __importDefault(require("./adapter/typescript"));
const strategy_1 = __importDefault(require("./strategy"));
const action_1 = require("./action");
const error_1 = require("./error");
const debug_1 = __importDefault(require("debug"));
class NodeMutation {
    /**
     * Configure NodeMutation
     * @static
     * @param options {Object}
     * @param options.adapter {Adapter} - adapter, default is TypescriptAdapter
     * @param options.strategy {Strategy} - strategy, default is Strategy.THROW_ERROR
     * @param options.tabWidth {Number} - tab width, default is 2
     */
    static configure(options) {
        if (options.adapter) {
            this.adapter = options.adapter;
        }
        if (options.strategy) {
            this.strategy = options.strategy;
        }
        if (options.tabWidth) {
            this.tabWidth = options.tabWidth;
        }
    }
    static getAdapter() {
        if (!this.adapter) {
            this.adapter = new typescript_1.default();
        }
        return this.adapter;
    }
    /**
     * Initialize a NodeMutation
     * @param source {string} - file source.
     */
    constructor(source) {
        this.source = source;
        this.actions = [];
    }
    /**
     * Append code to the ast node.
     * @param node {T} - ast node
     * @param code {string} - new code to append
     * @example
     * source code of the ast node is
     * ```
     * class FooBar {
     *   foo() {}
     * }
     * ```
     * then we call
     * ```
     * mutation.append(node, "bar() {}");
     * ```
     * the source code will be rewritten to
     * ```
     * class FooBar {
     *   foo() {}
     *   bar() {}
     * }
     * ```
     */
    append(node, code) {
        this.actions.push(new action_1.AppendAction(node, code).process());
    }
    /**
     * Delete source code of the child ast node
     * @param node {T} - current ast node
     * @param selectors {string|string[]} - selectors to find chid ast nodes
     * @param options {DeleteOptions}
     * @example
     * source code of the ast node is
     * ```
     * this.foo.bind(this)
     * ```
     * then we call
     * ```
     * mutation.delete(["expression.expression.dot", "expression.expression.name", "expression.arguments"])
     * ```
     * the source code will be rewritten to
     * ```
     * this.foo
     * ```
     */
    delete(node, selectors, options = {}) {
        this.actions.push(new action_1.DeleteAction(node, selectors, options).process());
    }
    /**
     * Group actions
     */
    group(func) {
        const currentActions = this.actions;
        const groupAction = new action_1.GroupAction();
        this.actions = groupAction.actions;
        func.call(this);
        this.actions = currentActions;
        this.actions.push(groupAction.process());
    }
    /**
     * Insert options
     * @typedef {Object} InsertOptions
     * @property {string} [at = "end"] - position to insert, "beginning" or "end"
     * @property {string} [to] - selector to find the child ast node
     */
    /**
     * Insert code to the ast node.
     * @param node {T} - ast node
     * @param code {string} - new code to insert
     * @param options {InsertOptions}
     * @example
     * source code of the ast node is
     * ```
     * this.foo
     * ```
     * then we call
     * ```
     * mutation.insert(node, "::", { at: "beginning" });
     * ```
     * the source code will be rewritten to
     * ```
     * ::this.foo
     * ```
     * if we call
     * ```
     * mutation.insert(node, ".bar", { to: "expression.expression" })
     * ```
     * the source code will be rewritten to
     * ```
     * this.foo.bar
     * ```
     */
    insert(node, code, options = { at: "end" }) {
        this.actions.push(new action_1.InsertAction(node, code, options).process());
    }
    /**
     * No operation.
     * @param node {T} - ast node
     */
    noop(node) {
        this.actions.push(new action_1.NoopAction(node).process());
    }
    /**
     * Prepend code to the ast node.
     * @param node {T} - ast node
     * @param code {string} - new code to prepend
     * @example
     * source code of the ast node is
     * ```
     * class FooBar {
     *   foo() {}
     * }
     * ```
     * then we call
     * ```
     * mutation.prepend(node, "bar() {}");
     * ```
     * the source code will be rewritten to
     * ```
     * class FooBar {
     *   bar() {}
     *   foo() {}
     * }
     * ```
     */
    prepend(node, code) {
        this.actions.push(new action_1.PrependAction(node, code).process());
    }
    /**
     * Remove source code of the ast node
     * @param node {T} - ast node
     * @param options {RemoveOptions}
     * @example
     * source code of the ast node is
     * ```
     * this.foo.bind(this)
     * ```
     * then we call
     * ```
     * mutation.remove()
     * ```
     * the source code will be completely removed
     */
    remove(node, options = {}) {
        this.actions.push(new action_1.RemoveAction(node, options).process());
    }
    /**
     * Replace options
     * @typedef {Object} ReplaceOptions
     * @property {string} with - new code to replace with
     */
    /**
     * Replace child node of the ast node with new code
     * @param node {T} - current ast node
     * @param selectors {string|string[]} - selectors to find chid ast nodes
     * @param options {ReplaceOptions}
     * @example
     * source code of the ast node is
     * ```
     * class FooBar {}
     * ```
     * then we call
     * ```
     * mutation.replace(node, "name", { with: "Synvert" });
     * ```
     * the source code will be rewritten to
     * ```
     * class Synvert {}
     * ```
     */
    replace(node, selectors, options) {
        this.actions.push(new action_1.ReplaceAction(node, selectors, options).process());
    }
    /**
     * Replace the ast node with new code
     * @param node {T} - ast node
     * @param code {string} - new code to replace
     * @example
     * source code of the ast node is
     * ```
     * !!foobar
     * ```
     * then we call
     * ```
     * mutation.replaceWith(node, "Boolean({{expression.operand.operand}})");
     * ```
     * the source code will be rewritten to
     * ```
     * Boolean(foobar)
     * ```
     */
    replaceWith(node, code) {
        this.actions.push(new action_1.ReplaceWithAction(node, code).process());
    }
    /**
     * Process Result
     * @typedef {Object} ProcessResult
     * @property {boolean} affected - if the source code is affected
     * @property {boolean} conflicted - if the actions are conflicted
     * @property {string} [newSource] - the new generated source code
     */
    /**
     * Rewrite the source code based on all actions.
     *
     * If there's an action range conflict,
     * it will raise a ConflictActionError if strategy is set to THROW_ERROR,
     * it will process all non conflicted actions and return `{ conflicted: true }`
     * @returns {ProcessResult}
     */
    process() {
        this.actions = this.flattenActions(this.actions);
        if (this.actions.length == 0) {
            return { affected: false, conflicted: false };
        }
        let conflictActions = [];
        this.actions = this.sortActions(this.actions);
        conflictActions = this.getConflictActions(this.actions);
        if (conflictActions.length > 0 &amp;&amp; this.isStrategry(strategy_1.default.THROW_ERROR)) {
            throw new error_1.ConflictActionError();
        }
        const newSource = this.rewriteSource(this.source, this.actions);
        return {
            affected: true,
            conflicted: conflictActions.length !== 0,
            newSource
        };
    }
    /**
     * Action
     * @typedef {Object} Action
     * @property {number} start - start position of the action
     * @property {number} end - end position of the action
     * @property {string} [newCode] - the new generated source code
     */
    /**
     * Test Result
     * @typedef {Object} TestResult
     * @property {boolean} affected - if the source code is affected
     * @property {boolean} conflicted - if the actions are conflicted
     * @property {Action[]} actions - actions to be processed
     */
    /**
     * Return the actions.
     *
     * If there's an action range conflict,
     * it will raise a ConflictActionError if strategy is set to THROW_ERROR,
     * it will process all non conflicted actions and return `{ conflicted: true }`
     * @returns {TestResult} if actions are conflicted and the actions
     */
    test() {
        this.actions = this.flattenActions(this.actions);
        if (this.actions.length == 0) {
            return { affected: false, conflicted: false, actions: [] };
        }
        let conflictActions = [];
        this.actions = this.sortActions(this.actions);
        conflictActions = this.getConflictActions(this.actions);
        if (conflictActions.length > 0 &amp;&amp; this.isStrategry(strategy_1.default.THROW_ERROR)) {
            throw new error_1.ConflictActionError();
        }
        return { affected: true, conflicted: conflictActions.length !== 0, actions: this.actions };
    }
    /**
     * It flattens a series of actions by removing any GroupAction objects that contain only a single action. This is done recursively.
     * @private
     * @param {Action[]} actions
     * @returns {Action[]} sorted actions
     */
    flattenActions(actions) {
        const newActions = [];
        actions.forEach(action => {
            if (action.type === "group") {
                newActions.push(this.flattenGroupAction(action));
            }
            else {
                newActions.push(action);
            }
        });
        return newActions.filter(action => action !== null);
    }
    /**
     * It flattens a group action.
     * @private
     * @param action {Action}
     * @returns {Action | null}
     */
    flattenGroupAction(action) {
        if (action.actions.length === 0) {
            return null;
        }
        else if (action.actions.length === 1) {
            if (action.actions[0].type === "group") {
                return this.flattenGroupAction(action.actions[0]);
            }
            else {
                return action.actions[0];
            }
        }
        else {
            action.actions = this.flattenActions(action.actions);
            return action;
        }
    }
    /**
     * Sort actions by start position and end position.
     * @private
     * @param {Action[]} actions
     * @returns {Action[]} sorted actions
     */
    sortActions(actions) {
        actions.sort(this.compareActions);
        actions.forEach(action => {
            if (action.type === "group") {
                this.sortActions(action.actions);
            }
        });
        return actions;
    }
    /**
     * Rewrite source code with actions.
     * @param source {string} source code
     * @param actions {Action[]} actions
     * @returns {string} new source code
     */
    rewriteSource(source, actions) {
        actions.reverse().forEach((action) => {
            if (action.type === "group") {
                source = this.rewriteSource(source, action.actions);
            }
            else if (typeof action.newCode !== "undefined") {
                source =
                    source.slice(0, action.start) +
                        action.newCode +
                        source.slice(action.end);
            }
        });
        return source;
    }
    /**
     * Action sort function.
     * @private
     * @param {Action} actionA
     * @param {Action} actionB
     * @returns {number} returns 1 if actionA goes before actionB, -1 if actionA goes after actionB
     */
    compareActions(actionA, actionB) {
        if (actionA.start > actionB.start)
            return 1;
        if (actionA.start &lt; actionB.start)
            return -1;
        if (actionA.end > actionB.end)
            return 1;
        if (actionA.end &lt; actionB.end)
            return -1;
        if (actionA.conflictPosition &amp;&amp; actionB.conflictPosition) {
            if (actionA.conflictPosition > actionB.conflictPosition)
                return 1;
            if (actionA.conflictPosition &lt; actionB.conflictPosition)
                return -1;
        }
        return 0;
    }
    /**
     * It changes source code from bottom to top, and it can change source code twice at the same time,
     * So if there is an overlap between two actions, it removes the conflict actions and operate them in the next loop.
     * @private
     * @param {Action[]} actions
     * @returns {Action[]} conflict actions
     */
    getConflictActions(actions) {
        let i = actions.length - 1;
        let j = i - 1;
        const conflictActions = [];
        if (i &lt; 0)
            return [];
        let beginPos = actions[i].start;
        let endPos = actions[i].end;
        while (j > -1) {
            if (beginPos &lt; actions[j].end) {
                conflictActions.push(actions.splice(j, 1)[0]);
            }
            else {
                i = j;
                beginPos = actions[i].start;
                endPos = actions[i].end;
            }
            j--;
        }
        actions.forEach(action => {
            if (action.type === "group") {
                conflictActions.push(...this.getConflictActions(action.actions));
            }
        });
        conflictActions.forEach(conflictAction => {
            (0, debug_1.default)("node-mutation")(`${conflictAction.constructor.name}[${conflictAction.start}-${conflictAction.end}]:${conflictAction.newCode}`);
        });
        return conflictActions;
    }
    isStrategry(strategy) {
        return !!NodeMutation.strategy &amp;&amp; (NodeMutation.strategy &amp; strategy) === strategy;
    }
}
NodeMutation.strategy = strategy_1.default.THROW_ERROR;
NodeMutation.tabWidth = 2;
exports.default = NodeMutation;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu Oct 19 2023 14:31:37 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
